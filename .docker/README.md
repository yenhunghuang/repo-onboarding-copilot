# ğŸ³ Docker & CI/CD Configuration

æœ¬ç›®éŒ„åŒ…å« Repo Onboarding Copilot çš„ Docker é…ç½®å’Œ CI/CD è‡ªå‹•åŒ–è¨­å®šã€‚

## ğŸ“ æª”æ¡ˆçµæ§‹

```
.docker/
â”œâ”€â”€ Dockerfile              # ç”Ÿç”¢ç’°å¢ƒ Docker æ˜ åƒ
â”œâ”€â”€ Dockerfile.dev          # é–‹ç™¼ç’°å¢ƒ Docker æ˜ åƒ (å«ç†±é‡è¼‰)
â”œâ”€â”€ docker-compose.yml      # Docker Compose é…ç½®
â”œâ”€â”€ docker-dev.sh           # é–‹ç™¼ç’°å¢ƒç®¡ç†è…³æœ¬
â”œâ”€â”€ .env.example            # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â””â”€â”€ README.md               # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒæº–å‚™

```bash
# è¤‡è£½ç’°å¢ƒè®Šæ•¸æª”æ¡ˆ
cp .docker/.env.example .docker/.env

# ç·¨è¼¯ç’°å¢ƒè®Šæ•¸ï¼ˆå¯é¸ï¼‰
nano .docker/.env

# ä½¿è…³æœ¬å¯åŸ·è¡Œ
chmod +x .docker/docker-dev.sh
```

### 2. é–‹ç™¼ç’°å¢ƒ

```bash
# å•Ÿå‹•åŸºæœ¬é–‹ç™¼ç’°å¢ƒï¼ˆåƒ…æ‡‰ç”¨ç¨‹å¼ï¼‰
.docker/docker-dev.sh start-dev

# å•Ÿå‹•å®Œæ•´é–‹ç™¼ç’°å¢ƒï¼ˆå«è³‡æ–™åº«ã€å¿«å–ï¼‰
.docker/docker-dev.sh start-full

# å•Ÿå‹•ç›£æ§ç’°å¢ƒï¼ˆå« Prometheusã€Grafanaï¼‰
.docker/docker-dev.sh start-monitor

# æŸ¥çœ‹æ—¥èªŒ
.docker/docker-dev.sh logs

# é€²å…¥é–‹ç™¼å®¹å™¨
.docker/docker-dev.sh shell

# åœæ­¢æ‰€æœ‰æœå‹™
.docker/docker-dev.sh stop
```

### 3. æœ¬åœ°æ¸¬è©¦

```bash
# åœ¨å®¹å™¨ä¸­åŸ·è¡Œæ¸¬è©¦
.docker/docker-dev.sh test

# åœ¨å®¹å™¨ä¸­åŸ·è¡Œ linting
.docker/docker-dev.sh lint

# åœ¨å®¹å™¨ä¸­åŸ·è¡Œå®‰å…¨æƒæ
.docker/docker-dev.sh security
```

## ğŸ—ï¸ Docker æ˜ åƒ

### ç”Ÿç”¢ç’°å¢ƒæ˜ åƒç‰¹é»
- **åŸºæ–¼ Alpine Linux**: æœ€å°åŒ–å®‰å…¨æ”»æ“Šé¢
- **å¤šéšæ®µå»ºç½®**: æ¸›å°‘æ˜ åƒå¤§å°
- **é root ä½¿ç”¨è€…**: å¢å¼·å®‰å…¨æ€§
- **å¥åº·æª¢æŸ¥**: è‡ªå‹•ç›£æ§æ‡‰ç”¨ç‹€æ…‹
- **å®‰å…¨é…ç½®**: Seccompã€AppArmor æ”¯æ´

### é–‹ç™¼ç’°å¢ƒæ˜ åƒç‰¹é»
- **ç†±é‡è¼‰**: ä½¿ç”¨ Air å·¥å…·è‡ªå‹•é‡æ–°ç·¨è­¯
- **é™¤éŒ¯æ”¯æ´**: Delve é™¤éŒ¯å™¨æ•´åˆ
- **é–‹ç™¼å·¥å…·**: åŒ…å« lintingã€å®‰å…¨æƒæå·¥å…·
- **Docker-in-Docker**: æ”¯æ´å®¹å™¨åˆ†æåŠŸèƒ½

## ğŸ”§ æœå‹™é…ç½®

### æ ¸å¿ƒæœå‹™

| æœå‹™ | ç«¯å£ | èªªæ˜ |
|------|------|------|
| **app** | 8080 | ä¸»æ‡‰ç”¨ç¨‹å¼ (ç”Ÿç”¢) |
| **dev** | 8080, 2345 | é–‹ç™¼ç’°å¢ƒ (å«é™¤éŒ¯å™¨) |

### æ“´å±•æœå‹™ (Profiles)

| Profile | æœå‹™ | ç«¯å£ | èªªæ˜ |
|---------|------|------|------|
| `cache` | redis | 6379 | Redis å¿«å– |
| `database` | postgres | 5432 | PostgreSQL è³‡æ–™åº« |
| `monitoring` | prometheus | 9090 | Prometheus ç›£æ§ |
| `monitoring` | grafana | 3000 | Grafana å„€è¡¨æ¿ |

## ğŸ“Š CI/CD æµç¨‹

### GitHub Actions å·¥ä½œæµç¨‹

æˆ‘å€‘çš„ CI/CD ç®¡é“åŒ…å«ä»¥ä¸‹å·¥ä½œæµç¨‹ï¼š

#### 1. **ci.yml** - æŒçºŒæ•´åˆ
- âœ… **ä»£ç¢¼å“è³ªæª¢æŸ¥**: Lint, Format, Vet
- ğŸ§ª **æ¸¬è©¦åŸ·è¡Œ**: å–®å…ƒæ¸¬è©¦ + è¦†è“‹ç‡ (â‰¥80%)
- ğŸ›¡ï¸ **å®‰å…¨æƒæ**: Gosec, Trivy, ä¾è³´æ¼æ´æª¢æŸ¥
- ğŸ”§ **å»ºç½®é©—è­‰**: è·¨å¹³å°å»ºç½®æ¸¬è©¦
- ğŸ³ **Docker å»ºç½®**: æ˜ åƒå»ºç½®å’Œå®‰å…¨æƒæ
- ğŸš€ **é è¦½éƒ¨ç½²**: PR å°ˆç”¨é è¦½ç’°å¢ƒ

#### 2. **claude-review.yml** - AI ç¨‹å¼ç¢¼å¯©æŸ¥
- ğŸ¤– **è‡ªå‹•å¯©æŸ¥**: Claude æ™ºèƒ½ç¨‹å¼ç¢¼åˆ†æ
- ğŸ” **å®‰å…¨æª¢æŸ¥**: SQL injection, XSS, è·¯å¾‘éæ­·
- âš¡ **æ•ˆèƒ½åˆ†æ**: N+1 queries, è¨˜æ†¶é«”æ´©æ¼
- ğŸ—ï¸ **æ¶æ§‹æª¢æŸ¥**: SOLID åŸå‰‡, æœ€ä½³å¯¦è¸
- ğŸ”§ **è‡ªå‹•ä¿®å¾©**: æ ¼å¼åŒ–å’Œå°éŒ¯èª¤ä¿®æ­£ (å¯é¸)

#### 3. **security.yml** - å®‰å…¨æƒæ
- ğŸ”’ **Go å®‰å…¨æƒæ**: Gosec éœæ…‹åˆ†æ
- ğŸ“¦ **ä¾è³´æƒæ**: govulncheck æ¼æ´æª¢æŸ¥
- ğŸ” **å¤šç¶­åº¦æƒæ**: Trivy æª”æ¡ˆç³»çµ±å’Œé…ç½®æƒæ
- ğŸ³ **æ˜ åƒæƒæ**: Docker æ˜ åƒå®‰å…¨åˆ†æ
- ğŸ“Š **å½™ç¸½å ±å‘Š**: å®Œæ•´å®‰å…¨åˆ†æå ±å‘Š

#### 4. **release.yml** - ç™¼å¸ƒéƒ¨ç½²
- ğŸ“¦ **å»ºç«‹ Release**: GitHub Release è‡ªå‹•åŒ–
- ğŸ—ï¸ **è·¨å¹³å°å»ºç½®**: Linux, macOS, Windows (AMD64/ARM64)
- ğŸ³ **æ˜ åƒç™¼å¸ƒ**: å¤šæ¶æ§‹ Docker æ˜ åƒ
- ğŸš€ **åˆ†éšæ®µéƒ¨ç½²**: Staging â†’ Production
- ğŸ“¢ **é€šçŸ¥æ•´åˆ**: Slack/Discord/Teams é€šçŸ¥

### å“è³ªé–€æª»

| æª¢æŸ¥é …ç›® | æ¨™æº– | å‹•ä½œ |
|----------|------|------|
| å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ | â‰¥ 80% | ğŸš« é˜»æ­¢åˆä½µ |
| é‡å¤§å®‰å…¨å•é¡Œ | = 0 | ğŸš« é˜»æ­¢åˆä½µ |
| é«˜é¢¨éšªå®‰å…¨å•é¡Œ | â‰¤ 2 | âš ï¸ éœ€è¦å¯©æŸ¥ |
| å»ºç½®æˆåŠŸç‡ | 100% | ğŸš« é˜»æ­¢åˆä½µ |
| Lint å•é¡Œ | = 0 | ğŸš« é˜»æ­¢åˆä½µ |

## ğŸ” å®‰å…¨æœ€ä½³å¯¦è¸

### å®¹å™¨å®‰å…¨
- âœ… é root ä½¿ç”¨è€…åŸ·è¡Œ
- âœ… æœ€å°æ¬Šé™åŸå‰‡
- âœ… å”¯è®€æª”æ¡ˆç³»çµ±
- âœ… Seccomp å®‰å…¨é…ç½®æª”
- âœ… è³‡æºé™åˆ¶å’Œè¶…æ™‚è¨­å®š

### CI/CD å®‰å…¨
- âœ… æ©Ÿå¯†è³‡è¨Šä½¿ç”¨ GitHub Secrets
- âœ… æœ€å°æ¬Šé™ GitHub Token
- âœ… ä¾è³´æ¼æ´è‡ªå‹•æƒæ
- âœ… æ˜ åƒç°½åå’Œé©—è­‰
- âœ… SARIF å®‰å…¨å ±å‘Šæ•´åˆ

## ğŸš€ éƒ¨ç½²ç­–ç•¥

### é–‹ç™¼æµç¨‹
```
feature branch â†’ PR â†’ Claude Review â†’ CI Checks â†’ Merge â†’ Deploy
```

### ç™¼å¸ƒæµç¨‹
```
Tag â†’ Build â†’ Security Scan â†’ Staging â†’ Manual Approval â†’ Production
```

### ç’°å¢ƒç®¡ç†
- **Development**: è‡ªå‹•éƒ¨ç½²ï¼Œå®Œæ•´æ¸¬è©¦ç’°å¢ƒ
- **Staging**: PR é è¦½ï¼Œæ¥è¿‘ç”Ÿç”¢é…ç½®
- **Production**: æ‰‹å‹•æ‰¹å‡†ï¼Œè—ç¶ éƒ¨ç½²

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

**Q: Docker å»ºç½®å¤±æ•—ï¼Ÿ**
```bash
# æ¸…ç† Docker å¿«å–
docker system prune -f
.docker/docker-dev.sh clean

# é‡æ–°å»ºç½®
.docker/docker-dev.sh build-dev
```

**Q: é–‹ç™¼ç’°å¢ƒå•Ÿå‹•å¤±æ•—ï¼Ÿ**
```bash
# æª¢æŸ¥å®¹å™¨ç‹€æ…‹
.docker/docker-dev.sh status

# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
.docker/docker-dev.sh logs dev
```

**Q: æ¸¬è©¦åœ¨å®¹å™¨ä¸­å¤±æ•—ï¼Ÿ**
```bash
# é€²å…¥å®¹å™¨æ‰‹å‹•é™¤éŒ¯
.docker/docker-dev.sh shell

# åœ¨å®¹å™¨å…§åŸ·è¡Œæ¸¬è©¦
make test
```

### æ•ˆèƒ½èª¿æ•´

**è¨˜æ†¶é«”é™åˆ¶**:
```yaml
# docker-compose.yml
deploy:
  resources:
    limits:
      memory: 2G
```

**ä¸¦è¡Œè™•ç†**:
```bash
# ç’°å¢ƒè®Šæ•¸
MAX_ANALYSIS_WORKERS=4
ANALYSIS_TIMEOUT=300s
```

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [åˆ†æ”¯ä¿è­·è¨­å®š](.github/branch-protection.md)
- [PR æ¨¡æ¿](.github/pull_request_template.md)
- [å°ˆæ¡ˆ README](../README.md)
- [æ¶æ§‹æ–‡ä»¶](../docs/architecture/)

## ğŸ¤ è²¢ç»æŒ‡å—

1. **Fork å°ˆæ¡ˆ** â†’ å»ºç«‹ feature branch
2. **æœ¬åœ°é–‹ç™¼** â†’ ä½¿ç”¨ `.docker/docker-dev.sh start-dev`
3. **åŸ·è¡Œæ¸¬è©¦** â†’ `.docker/docker-dev.sh test`
4. **å»ºç«‹ PR** â†’ è‡ªå‹•è§¸ç™¼ Claude Review å’Œ CI
5. **åˆä½µå¾Œ** â†’ è‡ªå‹•éƒ¨ç½²åˆ°æ¸¬è©¦ç’°å¢ƒ

---

**ğŸ¯ ç›®æ¨™**: é€éè‡ªå‹•åŒ– CI/CD æµç¨‹ï¼Œç¢ºä¿ç¨‹å¼ç¢¼å“è³ªã€å®‰å…¨æ€§å’Œå¯é çš„éƒ¨ç½²éç¨‹ã€‚

**ğŸ¤– AI å¢å¼·**: Claude Code è‡ªå‹•å¯©æŸ¥æä¾›æ™ºèƒ½ç¨‹å¼ç¢¼åˆ†æå’Œæ”¹é€²å»ºè­°ã€‚